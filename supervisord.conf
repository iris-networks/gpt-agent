[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
# Ensure the user supervisor runs as can write to the pidfile path (root can write to /tmp)

# --- BEGIN ADDED SECTION ---
[unix_http_server]
file=/tmp/supervisor.sock   ; path to your socket file
chmod=0700                 ; socket file mode (default 0700)
# chown=nobody:nogroup       ; socket file owner (default is root)
# username=user              ; basic auth username (default is no auth)
# password=123               ; basic auth password (default is no auth)

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL for a unix socket
# username=user                 ; should match server credentials (default is no auth)
# password=123                  ; should match server credentials (default is no auth)
# prompt=mysupervisor           ; cmd line prompt (default "supervisor")
# history_file=~/.sc_history    ; use readline history if available

# --- IMPORTANT: Do NOT include an [inet_http_server] section ---
# --- unless you specifically want the web UI enabled ---

# --- END ADDED SECTION ---


# --- Your existing [program:...] sections follow ---

[program:xserver]
# Runs the VNC X server session
command=/usr/bin/Xvnc :1 -desktop VNCDesktop -localhost no -SecurityTypes VncAuth -rfbauth /home/abc/.vnc/passwd -geometry 1280x800 -depth 24 -AlwaysShared
user=abc
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=HOME="/home/abc",USER="abc",DISPLAY=":1"

[program:openbox]
# Runs the lightweight window manager within the VNC session
command=/usr/bin/openbox-session
user=abc
autostart=true
autorestart=true
priority=20
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=DISPLAY=":1",HOME="/home/abc",USER="abc"

[program:novnc]
# Runs the websockify proxy for noVNC
command=/usr/bin/websockify --web=/usr/local/novnc 6901 localhost:5901
user=abc  # Can run as abc or root, doesn't matter much
autostart=true
autorestart=true
priority=30
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:nodeapp]
# Runs your Node.js application as root
command=node dist/index.js
directory=/app
user=abc
autostart=true
autorestart=true
priority=40
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
# --- CRITICAL: Provide environment for Nut.js to connect to abc's display ---
environment=DISPLAY=":1",XAUTHORITY="/home/abc/.Xauthority",HOME="/home/abc",USER="abc"